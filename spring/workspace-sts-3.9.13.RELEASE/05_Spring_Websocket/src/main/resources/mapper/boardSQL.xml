<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="board">
	<select id="selectBoardList" parameterType="map" resultType="b">
		select * from
		(select rownum as rnum, b.* from
		(select
		board_no as boardNo,
		board_title as boardTitle,
		board_writer as boardWriter,
		board_date as boardDate
		from board order by 1 desc)b)
		where rnum between #{start} and #{end}
	</select>

	<select id="totalCount" resultType="int">
		select count(*) from board
	</select>

	<select id="selectOneBoard" parameterType="_int"
		resultMap="getBoard">
		select
		*
		from board where board_no=#{_parameter}
	</select>

	<select id="selectFileList" parameterType="_int" resultType="f">
		select
		file_no as fileNo,
		board_no as boardNo,
		filename,
		filepath
		from file_tbl where board_no =#{_parameter}
	</select>
	<resultMap type="b" id="getBoard">
		<result column="board_no" property="boardNo" />
		<result column="board_title" property="boardTitle" />
		<result column="board_writer" property="boardWriter" />
		<result column="board_content" property="boardContent"/>
		<result column="board_date" property="boardDate"/>
		<collection property="fileList"
					select="selectFileList"
					column="board_no"
					ofType="f"
					javaType="java.util.ArrayList"
		/>
	</resultMap>
	<!-- resultMap은 두 테이블을 조회할때 사용 비효율; -->
	
	<insert id="insertBoard" parameterType="b">
			insert into board values
				(
					board_seq.nextval,
					#{boardTitle},
					#{boardWriter},
					#{boardContent},
					to_char(sysdate,'yy-mm-dd')
				)
		<selectKey resultType="_int" order="AFTER" keyProperty="boardNo">
			select max(board_no) from board
		</selectKey>
	</insert>
	<select id = "selectBoardNo" resultType="_int">
		select max(board_no) from board
	</select>
	
	<insert id="insertFile" parameterType="f">
		insert into file_tbl values
			(
				file_seq.nextval,
				#{boardNo},
				#{filename},
				#{filepath}
			)
	</insert>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</mapper>